#!/bin/bash

cd ${APPDIR}

if ! [ -f ${APPDIR}/${APP_GAME_NAME}/cfg/server.cfg ]; then
	if [ -f ~/server.cfg ]; then
		cp ~/server.cfg ${APPDIR}/${APP_GAME_NAME}/cfg/server.cfg

		if ! [ "x${APP_SERVER_NAME}" = "x" ]; then
			sed -i "s/^hostname.*/hostname \"${APP_SERVER_NAME}\"/" ${APPDIR}/${APP_GAME_NAME}/cfg/server.cfg
		fi
	fi
fi

if ! [ "x${APP_SERVER_TOKEN}" = "x" ]; then
	STEAM_SERVER_TOKEN="+sv_setsteamaccount ${APP_SERVER_TOKEN}"
fi

if [ "$USE_SRCDS" = "true" ]; then
	if ! [ "x${APP_GAME_NAME}" = "x" ]; then
		APP_GAME_NAME="-game ${APP_GAME_NAME}"
	fi

	echo "running: ./srcds_run -console ${APP_GAME_NAME} -nohltv ${STEAM_SERVER_TOKEN} +maxplayers ${APP_SERVER_MAXPLAYERS} +map ${APP_SERVER_MAP} -port ${APP_SERVER_PORT}"
	./srcds_run -console ${APP_GAME_NAME} -nohltv ${STEAM_SERVER_TOKEN} +maxplayers ${APP_SERVER_MAXPLAYERS} +map ${APP_SERVER_MAP} -port ${APP_SERVER_PORT}
else
	echo "Unknown Server Startup Usage"
	exit 1
fi


